<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../manual.css" type="text/css" />
</head>
<body>
<hr />
<h2 id="Device-Driver-tef_em1d-use-Source-Configuration">Device Driver (tef_em1d use) Source Configuration</h2>
<hr />
<ul>
<li><a href="#Introduction">1. Introduction</a></li>
<li><a href="#Directory-Configuration">2. Directory Configuration</a></li>
<li><a href="#clk-Directory">3. clk Directory</a></li>
<li><a href="#console-Directory">4. console Directory</a></li>
<li><a href="#kbpd-Directory">5. kpbd Directory</a></li>
<li><a href="#lowkbpd-Directory">6. lowkbpd Directory</a></li>
<li><a href="#screen-Directory">7. screen Directory</a></li>
<li><a href="#sysdsk-Directory">8. sysdsk Directory</a></li>
<li><a href="#build-Directory">9. build Directory</a></li>
</ul>
<hr />
<h3 id="Introduction">1. Introduction</h3>
<p>This section explains the source code configuration of the device driver used with the T-Engine reference board (tef_em1d).</p>
<ul>
<li>Clock driver</li>
<li>Console driver</li>
<li>KB/PD driver</li>
<li>Screen driver</li>
<li>System disk driver</li>
</ul>
<p>For more information about the functional specifications of each device driver, please refer to the<br />&quot;T-Engine Standard Device Driver Specifications&quot; released by <a href="http://www.tron.org/">TRON Forum</a>, and <a href="impl-tef_em1d.txt">&quot;T-Kernel 2.0 (tef_em1d) Implementation Specification&quot;</a> for implementation dependencies.</p>
<h3 id="Directory-Configuration">2. Directory Configuration</h3>
<p>The device driver source code is included in the T-Kernel source code package.</p>
<p>The directory configuration diagram for the entire device driver source is described below.</p>
<ul>
<li><p>The &quot;lib&quot;, &quot;include&quot;, &quot;etc&quot; resources in the T-Kernel source directory are used to create the device drivers.</p></li>
<li><p>Device drivers are placed in the upper part of the &quot;&lt;Model Name&gt;&quot; directory, because device drivers fundamentally differ for each hardware target that they run on and use different rules from the basic T-Kernel directory configuration.</p></li>
<li><p>The &lt;Model Name&gt; is &quot;tef_em1d&quot;.</p></li>
</ul>
<p><!-- dummy comment line for breaking list --></p>
<pre><code>  tkernel_source
    |
    |-- ...               (T-Kernel source directory)
    |-- lib                     Library
    |-- include                 Definition file (header file)
    |   `-- device                 Device driver definition file
    |-- etc                     make rule, various scripts
    |
    |-- driver           Device driver source directory
       `-- &lt;Model Name&gt;
           |
           |-- clk              Clock driver
           |   |-- build
           |   `-- src
           |       `-- svc          For the extended SVC interface
           |
           |-- console          Console driver
           |   |-- build
           |   `-- src
           |       `-- svc          For the extended SVC interface
           |
           |-- kbpd             KB/PD driver
           |   |-- build
           |   `-- src
           |
           |-- lowkbpd          KB/PD - Actual I/O driver
           |   |-- build
           |   `-- src
           |
           |-- screen          Screen driver
           |   |-- build
           |   `-- src
           |
           |-- sysdsk          System disk driver
           |   |-- build
           |   |-- obj            Object file for MMC use
           |   `-- src
           |
           `-- build           Overall build directory</code></pre>
<h3 id="clk-Directory">3. clk Directory</h3>
<p>This is the source for the clock driver which supports RTC on the T-Engine reference board.</p>
<p>The serial interface (I2Cï¼ŒSPI) needed to access RTC is also used by other device drivers, so it is implemented as a separate subsystem which is accessed through extended SVC. For this reason, the extended SVC interface library is required.</p>
<p>Run make in the build directory to build both the object file and the extended SVC interface library. The interface library source and definition files are placed in the &quot;src/svc&quot; subdirectory. If they do not exist, they are automatically generated by a &quot;perl&quot; script.</p>
<p>The object file created in the build directory is copied to the &quot;driver/&lt;Model Name&gt;/build&quot; directory, and the interface library (libem1diic.a) is copied to the &quot;tkernel_source/lib/build/&lt;Model Name&gt;&quot; directory.</p>
<h3 id="console-Directory">4. console Directory</h3>
<p>This is the source for the console driver which supports the serial port on the T-Engine reference board.</p>
<p>The console driver is implemented as a subsystem which is accessed through extended SVC, so the extended SVC interface library is required.</p>
<p>Run make in the build directory to build both the object file and the extended SVC interface library. The interface library source and definition files are placed in the &quot;src/svc&quot; subdirectory. If they do not exist, they are automatically generated by a &quot;perl&quot; script.</p>
<p>The object file created in the build directory is copied to the &quot;driver/&lt;Model Name&gt;/build&quot; directory, and the interface library (libconsolesvc.a) is copied to the &quot;tkernel_source/lib/build/&lt;Model Name&gt;&quot; directory.</p>
<h3 id="kbpd-Directory">5. kbpd Directory</h3>
<p>This is the KB/PD driver source to support a general keyboard and pointing device (mouse). This driver only performs logical processing which does not depend on the actual device, so the processing for the actual device is handled by the Actual I/O driver (lowkbpd).</p>
<p>The object file created in the build directory is copied to the &quot;driver/&lt;Model Name&gt;/build&quot; directory.</p>
<h3 id="lowkbpd-Directory">6. lowkbpd Directory</h3>
<p>This is the source for the Actual I/O driver which supports the button switches on the touch panel and board connected to the T-Engine reference board.</p>
<p>It processes the touch panel as a pointing device and the button switches as keyboard keys.</p>
<p>The object file created in the build directory is copied to the &quot;driver/&lt;Model Name&gt;/build&quot; directory.</p>
<h3 id="screen-Directory">7. screen Directory</h3>
<p>This is the source for the screen driver which supports the LCD connected to the T-Engine reference board.</p>
<p>The object file created in the build directory is copied to the &quot;driver/&lt;Model Name&gt;/build&quot; directory.</p>
<h3 id="sysdsk-Directory">8. sysdsk Directory</h3>
<p>This is the source for the system disk driver which supports the micro SD card slot on the T-Engine reference board.</p>
<p>However, the source files for the micro SD card (MMC) access functions are not included. The object file is placed in the &quot;obj&quot; subdirectory.</p>
<p>Only micro SD cards (SD, SDHC) are supported. Other types of disk media are not supported.</p>
<p>The object file created in the build directory is copied to the &quot;driver/&lt;Model Name&gt;/build&quot; directory.</p>
<h3 id="build-Directory">9. build Directory</h3>
<p>This is the build directory for creating all of the device drivers together. The object file for each device driver that is created is placed in this directory, and the previous object file is backed up in the &quot;!OLD&quot; subdirectory.</p>
<p>The object files for each device driver which are placed in this directory are used when building the T-Kernel execution image.</p>
</body>
</html>
